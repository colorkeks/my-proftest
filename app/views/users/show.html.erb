<%- model_class = User -%>
<% if @user.roles.first.name == 'Тестируемый' %>
    <div class="container">
      <div class="row">
        <div class="col-lg-12">
          <!-- Блок навигации по тесту с отметкой правильности выполненных тестовых заданий -->
          <div class="row">
            <div class="col-lg-12">
              <h3 class="text-center test-title">Личный кабинет</h3>
            </div>
          </div>

          <!-- Блок формулировски тестового задания -->
          <div class="row">
            <div class="col-lg-12 question-content">
              <div class="sub-menu">
                <div class="item selected" href="#attestation" aria-controls="attestation" role="tab" data-toggle="tab">
                  Аттестация
                </div>
                <div class="item" href="#practice" aria-controls="practice" role="tab" data-toggle="tab">
                  Тренировка
                </div>
                <div class="item" href="#history" aria-controls="history" role="tab" data-toggle="tab">
                  История
                </div>
                <div class="item" href="#my_tests" aria-controls="my_tests" role="tab" data-toggle="tab">
                  Мои тесты
                </div>
              </div>
              <div class="test-case">
                <div class="row">
                  <div class="col-lg-12">
                    <div class="tab-content">
                      <div role="tabpanel" class="tab-pane active" id="attestation">
                        <div style="text-align: center">
                          <span class="title">Аттестационных тестов не найдено </span>
                        </div>
                      </div>
                      <div role="tabpanel" class="tab-pane" id="practice">
                        <table class="table">
                          <thead>
                          <tr>
                            <th>Название:</th>
                            <th>Кол-во вопросов:</th>
                            <th>Время:</th>
                            <th>Действия:</th>
                          </tr>
                          </thead>
                          <tbody>

                          <% @tests.each do |test| %>
                              <tr>
                                <td><%= test.title %></td>
                                <td><%= test.tasks.count %></td>
                                <td>N/A</td>
                                <td><%= link_to 'Пройти тест', {:controller => :tries ,:action => :create ,:try => {:date => Time.now, :user_id => @user.id, :test_id => test.id}}, :method => 'POST', :class => 'btn btn-default' %></td>
                              </tr>
                          <% end %>
                          </tbody>
                        </table>
                      </div>
                      <div role="tabpanel" class="tab-pane" id="history">
                        <table class="table">
                          <thead>
                          <tr>
                            <th>Название:</th>
                            <th>Дата:</th>
                            <th>Статус:</th>
                            <th>Правильность:</th>
                            <th>Оценка:</th>
                            <th>Действия:</th>
                          </tr>
                          </thead>
                          <tbody>
                          <% @tries.each do |try| %>
                              <tr>
                                <td><%= try.test.title %></td>
                                <td><%= try.date %></td>
                                <td>
                                  <span class="label <%= try.status == 'Выполнен' ? 'label-success' : 'label-danger' %> "><%= try.status %></span>
                                </td>
                                <td style="text-align: center"><%= try.rate.nil? ? '' : try.rate.round().to_s + '%' %></td>
                                <td>
                                  <% if !try.rate.nil? %>
                                      <% if try.rate > 92 %>
                                          <%= 'Отлично' %>
                                      <% elsif try.rate >= 70 %>
                                          <%= 'Хорошо' %>
                                      <% elsif try.rate >= 50 %>
                                          <%= 'Удовл.' %>
                                      <% else %>
                                          <%= 'Неуд.' %>
                                      <% end %>
                                  <% end %>
                                </td>
                                <td>
                                  <% if try.status == 'Выполнен' %>
                                      <%= link_to t('.пройти', :default => t("helpers.links.посмотреть результат")),
                                                  try_result_try_path(try.id), :class => 'btn btn-default btn-md' %>
                                  <% else %>
                                      <%= link_to t('.пройти', :default => t("helpers.links.пройти тест")),
                                                  show_question_try_path(try.id), :class => 'btn btn-default btn-md' %>
                                  <% end %>
                                </td>
                              </tr>
                          <% end %>
                          </tbody>
                        </table>
                      </div>
                      <div role="tabpanel" class="tab-pane" id="my_tests">
                        <table class="table">
                          <thead>
                          <tr>
                            <th><%= model_class.human_attribute_name(:id) %></th>
                            <th><%= model_class.human_attribute_name(:title) %></th>
                            <th><%= model_class.human_attribute_name(:description) %></th>
                            <th><%= model_class.human_attribute_name(:created_at) %></th>
                            <th><%= t '.actions', :default => t("helpers.actions") %></th>
                          </tr>
                          </thead>
                          <tbody>
                          <% @tests.where(:user_id => params[:id]).each do |test| %>
                              <tr>
                                <td><%= link_to test.id, test_path(test) %></td>
                                <td><%= test.title %></td>
                                <td><%= test.description %></td>
                                <td><%= l test.created_at %></td>
                                <td>
                                  <%= link_to t('.show', :default => t("helpers.links.show")),
                                              test_path(test), :class => 'btn btn-default btn-md' %>
                                  <%= link_to t('.edit', :default => t("helpers.links.edit")),
                                              edit_test_path(test), :class => 'btn btn-default btn-md' %>
                                  <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                                              test_path(test),
                                              :method => :delete,
                                              :data => {:confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?'))},
                                              :class => 'btn btn-md btn-danger' %>
                                </td>
                              </tr>
                          <% end %>
                          </tbody>
                        </table>
                        <%= link_to t('.new', :default => t("helpers.links.Создать тест")),
                                    create_test_user_path,
                                    :class => 'btn btn-primary' %>
                      </div>
                    </div>
                    <hr/>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
<% elsif @user.roles.first.name == 'Методолог' %>
    <div class="page-header">
      <h1><%= t '.title', :default => model_class.model_name.human.titleize %></h1>
    </div>

    <dl class="dl-horizontal">
      <dt><strong><%= model_class.human_attribute_name(:first_name) %>:</strong></dt>
      <dd><%= @user.first_name %></dd>
      <dt><strong><%= model_class.human_attribute_name(:last_name) %>:</strong></dt>
      <dd><%= @user.last_name %></dd>
      <dt><strong><%= model_class.human_attribute_name(:job) %>:</strong></dt>
      <dd><%= @user.job %></dd>
      <dt><strong>Роль:</strong></dt>
      <dd><%= @user.roles.first.name %></dd>
    </dl>
    <hr>
    <%= link_to t('.edit', :default => t("helpers.links.Редактировать")),
                edit_user_path(@user), :class => 'btn btn-default btn-md' %>

    <div class="page-header">
      <h2>Тесты</h2>
    </div>
    <table class="table table-striped">
      <thead>
      <tr>
        <th><%= model_class.human_attribute_name(:id) %></th>
        <th><%= model_class.human_attribute_name(:title) %></th>
        <th><%= model_class.human_attribute_name(:description) %></th>
        <th><%= model_class.human_attribute_name(:created_at) %></th>
        <th><%= t '.actions', :default => t("helpers.actions") %></th>
      </tr>
      </thead>
      <tbody>
      <% @tests.where(:user_id => params[:id]).each do |test| %>
          <tr>
            <td><%= link_to test.id, test_path(test) %></td>
            <td><%= test.title %></td>
            <td><%= test.description %></td>
            <td><%= l test.created_at %></td>
            <td>
              <%= link_to t('.show', :default => t("helpers.links.show")),
                          test_path(test), :class => 'btn btn-default btn-md' %>
              <%= link_to t('.edit', :default => t("helpers.links.edit")),
                          edit_test_path(test), :class => 'btn btn-default btn-md' %>
              <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                          test_path(test),
                          :method => :delete,
                          :data => {:confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?'))},
                          :class => 'btn btn-md btn-danger' %>
            </td>
          </tr>
      <% end %>
      </tbody>
    </table>
    <%= link_to t('.new', :default => t("helpers.links.Создать тест")),
                create_test_user_path,
                :class => 'btn btn-primary' %>
<% end %>


<script>
    tab_selected();
</script>