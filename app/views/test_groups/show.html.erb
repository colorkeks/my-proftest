<%- model_class = TestGroup -%>
<div class="page-header">
  <div class="row">
  <div class="col-md-4">
    <h1>Каталог</h1>
  </div>
  <div class="col-md-8">
    <h3>
      <% @test_group.ancestors.each do |parent| %>
          <%= link_to parent.name, parent %>
          &nbsp;&#47;&nbsp;
      <% end %>
      <b><%= @test_group.name %></b>

      <span class="dropdown" id="dropdown-create">
        <span class="dropdown dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
        <span class="caret"></span>
        </span>
        <ul class="dropdown-menu dropdown-menu-right" role="menu" aria-labelledby="dropdownMenu1">
          <li role="presentation">
            <%= link_to 'переименовать', edit_test_group_path(@test_group), remote: true, role: 'menuitem', tabindex: '-1' %>
          </li>
          <li role="presentation">
            <%= link_to t('.edit', :default => t("helpers.links.edit")), edit_test_group_path(@test_group), :class => 'btn btn-default btn-xs' %>
          </li>
          <li role="presentation">
            <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
                        test_group_path(@test_group),
                        :method => 'delete',
                        :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                        :class => 'btn btn-danger btn-xs' %>
          </li>
        </ul>
      </span>
    </h3>
  </div>
  </div>
</div>

<div class="row">
  <div class="col-md-4">
    <div class="dropdown" id="dropdown-create">
      <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-expanded="true">
        Создать
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
        <li role="presentation">
          <%= link_to 'Папку', new_test_group_path(parent_id: @test_group.id), remote: true, role: 'menuitem', tabindex: '-1' %>
        </li>
        <li role="presentation">
          <%= link_to 'Тест', new_test_path(test_group_id: @test_group.id), remote: true, role: 'menuitem', tabindex: '-1' %>
        </li>
      </ul>
    </div>
    <%#= link_to 'Добавить группу', new_test_group_path(parent_id: @test_group.id), :class => 'btn btn-primary btn-sm' %>
    <%#= link_to 'Добавить группу', new_test_group_path(parent_id: @test_group.id), :class => 'btn btn-primary btn-sm' %>


    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title" id="myModalLabel">Modal title</h4>
          </div>
          <div class="modal-body" id="new-form">
            ...
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" class="btn btn-primary">Save changes</button>
          </div>
        </div>
      </div>
    </div>


    <%#= link_to 'Добавить тест', new_test_path(test_group_id: @test_group.id), :class => 'btn btn-primary btn-sm' %>
    <br/><br/>

    <% last_level = -1 %>
    <% TestGroup.root.self_and_descendants.each do |group| %>
        <% current_level = group.level %>
        <% if current_level < last_level %>
            </li>
            <% (last_level - current_level).times do %>
                </ul></li>
            <% end %>
        <% elsif current_level > last_level  %>
            <ul>
        <% else %>
            </li>
        <% end %>
        <li>
          <span class="glyphicon glyphicon-folder-close folder-tree-folder" aria-hidden="true"></span>
          <!--
          <a href="#" class="folder-tree-folder" onclick="$(this).parent().find('ul').slideToggle(); return false;" >+</a>
          -->
          <% if @test_group == group %>
          <b>(<%= current_level %>)<%= group.name %></b>
          <% else %>
            <%= link_to "(#{current_level})#{group.name}", group %>
          <% end %>
          <%if @test_group == group %></b><%end%>

          <% last_level = current_level %>
    <% end %>
    <% if last_level != -1%>
        </li>
    <% end %>
    <% (last_level).times do %>
        </ul></li>
    <% end %>
    <%if last_level != -1%>
        </ul>
    <% end %>
  </div>
  <div class="col-md-8">
    <div class="col-md-4">
      <div class="btn-group" role="group" aria-label="">
        <button type="button" class="btn btn-default" onclick="toggleCheckbox();"><span class="glyphicon glyphicon-unchecked" aria-hidden="true"></span></button>
        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-th" aria-hidden="true"></span></button>
        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-folder-close" aria-hidden="true"></span></button>
        <button type="button" class="btn btn-default"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button>
       </div>
    </div>

    <div class="col-md-4 pull-right">
      <%#= page_entries_info @elements, :model => Test, :html => false %>
      <span class="pagination">c <b><%= [@elements.per_page * (@elements.current_page-1) + 1, @elements.total_entries].min %></b> по <b><%= [@elements.per_page * (@elements.current_page), @elements.total_entries].min %></b> из <b><%=@elements.total_entries %></b><br/>&nbsp;</span>
      <%= will_paginate @elements, renderer: BootstrapPagination::Rails, :page_links => false, next_label: '>', previous_label: '<' %>
    </div>

    <table class="table table-striped">
      <thead>
      <tr>
        <th width="10px;"></th>
        <th>Название</th>
        <th>Действия</th>
      </tr>
      </thead>
      <tbody>
      <% @elements.each do |element| %>
          <tr data-class="<%=element.class%>" data-id="<%= element.id %>">
            <td><%= check_box_tag 'check', 1, false, class: 'element_checkbox' %></td>
            <td>
                <% if element.is_a?(TestGroup)%>
                    <% test_group = element %>
                    <span class="glyphicon glyphicon-folder-close" aria-hidden="true"></span>&nbsp;<%= link_to test_group.name, test_group_path(test_group) %>
                <% elsif element.is_a?(Test) %>
                    <% test = element %>
                    <span class="glyphicon glyphicon-list-alt" aria-hidden="true"></span>&nbsp;<%= link_to test.title, test_path(test) %>
                <% else %>
                <% end %>


            </td>
            <td>
              <% if element.is_a?(TestGroup)%>
                  <% test_group = element %>

              <% elsif element.is_a?(Test) %>
                  <% test = element %>

              <% else %>
              <% end %>
            </td>
          </tr>
      <% end %>
      </tbody>
    </table>


  </div>
</div>

<script type="text/javascript">
    function toggleCheckbox() {
        var checked_checkboxes = $('.element_checkbox:checked');
        if (checked_checkboxes.size() > 0) {

            checked_checkboxes.prop('checked', false);
        } else {
            $('.element_checkbox').prop('checked', 'checked');
        }
        return false;
    }
    function bulkDestroy() {
        var checked_checkboxes = $('.element_checkbox:checked');
        if (checked_checkboxes.size() > 0) {
            for cb in checked_checkboxes


            checked_checkboxes.prop('checked', false);
        } else {
            $('.element_checkbox').prop('checked', 'checked');
        }
        return false;
    }
</script>