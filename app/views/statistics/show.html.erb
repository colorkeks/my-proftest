<script type="text/javascript">
    $(function () {
        $('.inlinesparkline').sparkline();
        $('.sparklines').sparkline('html',
                {     type: 'pie',
                    height: '11.0em',
                    sliceColors: ['#D9D9C2', '#656563']
                });
    });
</script>
<!-- Открытие контейнера -->
<div class="container-fluid">

  <!-- Начало блока с заголовком -->
  <div class="row">
    <div class="col-lg-12">
      <center><b><h3>Модуль статистики</h3></b></center>
    </div>
  </div>
  <!-- Конец блока с заголовком -->

  <!-- Начало блока с названием теста -->
  <div class="row">
    <div class="col-lg-12">
      <hr>
      <center><h4>Общая статистика теста по специальности "Патологическая анатомия"</h4></center>
      <hr>
    </div>
  </div>
  <!-- Конец блока с названием теста -->

  <!-- Начало блока с общей информацией о тесте -->
  <div class="row">
    <div class="col-lg-12">
      <table class="table table-bordered">
        <tr>
          <th class="cell-header-bgcolor">Кол-во заданий в тесте:</th>
          <th class="cell-header-bgcolor">Кол-во попыток:</th>
          <th class="cell-header-bgcolor">Кол-во испытуемых:</th>
          <th class="cell-header-bgcolor">Испытуемые / попытки:</th>
          <th class="cell-header-bgcolor">Средняя оценка за тест:</th>
          <th class="cell-header-bgcolor">Среднее время, потраченное на тест:</th>
        </tr>
        <tr>
          <td><%= @test.tasks.count %></td>
          <td><%= @test.tries.count %></td>
          <td>10</td>
          <td></td>
          <td><%= @test.tries.where(:status => 'Выполнен').any? ? (@test.tries.inject(0) { |sum, hash| sum + hash[:rate] })/@test.tries.count : 'N/A' %></td>
          <td><%= (@hours && @minutes).nil? ? 'N/A' : (@hours.to_s + ' часов ' + @minutes.to_s + ' минут') %></td>
        </tr>
      </table>
    </div>
  </div>
  <!-- Конец блока с общей информацией о тесте -->

  <!-- Начало блока с заголовком -->
  <div class="row">
    <div class="col-lg-12">
      <hr>
      <center><h4>Статистика заданий теста по специальности "Патологическая анатомия"</h4></center>
      <hr>
    </div>
  </div>
  <!-- Конец блока с заголовком -->

  <!-- НАЧАЛО ВОПРОСА №1 -->
  <% @test.tasks.each do |task| %>
  <!-- Начало блока со статистикой -->
  <div class="row">
    <!-- Начало блока с информацией о вопросе -->
    <div class="col-lg-6">
      <div class="row">
        <div class="col-lg-12">
              <table class="table table-bordered">
                <tr>
                  <td colspan="4" class="cell-header-bgcolor">
                    <p><b>Номер задания и его формулировка:</b></p>
                  </td>
                </tr>
                <tr>
                  <td colspan="4" class="cell-header-padding">
                    <p><%= task.text%></p>
                  </td>
                </tr>
                <tr>
                  <th class="cell-header-bgcolor">
                    <p>Кол-во:</p>
                  </th>
                  <th class="cell-header-bgcolor">
                    <p>Правильный:</p>
                  </th>
                  <th class="cell-header-bgcolor">
                    <p>%</p>
                  </th>
                  <th class="cell-header-bgcolor">
                    <p>Время:</p>
                  </th>
                </tr>
                <tr>
                  <td>
                    <p>
                      <%
                         count = 0
                         @test.tries.each do |try|
                           try.task_results.each do |task_result|
                             if task_result.task_id == task.id
                               count = count + 1
                             end
                           end
                         end
                      %>
                      <%= count %>
                    </p>
                  </td>
                  <td>
                    <p>
                      <% task.answers.where(:correct => true).each do |answer|%>
                        <%= answer.text %>
                      <% end%>
                    </p>
                  </td>
                  <td>
                    <span class="sparklines">60,40</span>
                  </td>
                  <td>
                    <p>00:02:20</p>
                  </td>
                </tr>
              </table>
              </div>
              </div>
              </div>
              <!-- Конец блока с информацией о вопросе -->

              <!-- Начало блока с информацией об ответе -->
              <div class="col-lg-6">
                <table class="table table-bordered">
                  <tr>
                    <th colspan="3" class="cell-header-bgcolor">
                      <p>Варианты ответа:</p>
                    </th>
                  </tr>
                  <% task.answers.each do |answer| %>
                  <tr>
                    <td width=80%>
                      <p><%= answer.text %></p>
                    </td>
                    <td width=5%>
                      <p>15%</p>
                    </td>
                    <td width=15%>
                      <div class="progress">
                        <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 15%;">
                          <span class="sr-only">15% Complete</span>
                        </div>
                      </div>
                    </td>
                  </tr>
                  <% end %>
                </table>
              </div>
              <!-- Конец блока с информацией об ответе -->
              </div>
          <% end %>
          <!-- Конец блока со статистикой -->

          <!-- КОНЕЦ ВОПРОСА №1 -->

          <!-- Начало блока с разделителем вопросов -->
          <div class="row">
            <div class="col-lg-12">
              <hr>
            </div>
          </div>
          <!-- Конец блока с разделителем вопросов -->

          </div>
<!-- Закрытие контейнера -->
